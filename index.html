<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶∂‡¶¨‡ßç‡¶¶ ‡¶ï‡ßÅ‡¶á‡¶ú + ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family: "Noto Sans Bengali", sans-serif; background: #f8f9fa; }
.quiz-card { max-width: 500px; margin: 30px auto; padding: 25px 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.word { font-size: 36px; font-weight: bold; margin-bottom: 10px; }
.result { margin-top: 10px; font-size: 18px; font-weight: 600; }
.btn-group-mcq { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
.btn-group-mcq .btn { width: 100%; min-height: 60px; font-size: 18px; }
.admin-panel { display:none; margin-top:40px; }
.table td, .table th { vertical-align: middle; }
.jsonBox { display:none; margin-top:20px; }
textarea { font-family: monospace; }
.correct { border: 2px solid green !important; }
.wrong { border: 2px solid red !important; }
</style>
</head>
<body>

<div class="container">

  <!-- Toggle Buttons -->
  <div class="text-end mt-3">
    <button id="quizBtn" class="btn btn-primary" onclick="showQuiz()">üéÆ ‡¶ï‡ßÅ‡¶á‡¶ú</button>
    <button id="adminBtn" class="btn btn-dark" onclick="showAdmin()">‚öôÔ∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</button>
  </div>

  <!-- Quiz Section -->
  <div id="quizSection">
    <div class="card quiz-card text-center">
      <div class="card-body">
        <div id="word" class="word">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>

        <div class="btn-group-mcq">
          <button class="btn btn-primary" onclick="checkAnswer(this)">A</button>
          <button class="btn btn-success" onclick="checkAnswer(this)">B</button>
          <button class="btn btn-warning" onclick="checkAnswer(this)">C</button>
          <button class="btn btn-danger" onclick="checkAnswer(this)">D</button>
        </div>

        <div class="result" id="result"></div>
        <button class="btn btn-secondary mt-3" onclick="nextWord()">‡¶™‡¶∞‡ßá‡¶∞ ‡¶∂‡¶¨‡ßç‡¶¶</button>
      </div>
    </div>
  </div>

  <!-- ================= Admin Panel ================= -->
  <div id="adminPanel" class="admin-panel">
    <h2 class="mb-4">üß© ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú</h2>
    <button class="btn btn-danger mb-4" onclick="resetData()">‚ôªÔ∏è Default</button>

    <!-- Words Section -->
    <h3>Words </h3>
    <table class="table table-bordered table-striped" id="wordsTable">
      <thead class="table-dark">
        <tr><th>#</th><th>‡¶∂‡¶¨‡ßç‡¶¶</th><th>‡¶ß‡¶∞‡¶®</th><th>Correct</th><th>Wrong</th><th>Weight</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr>
      </thead><tbody></tbody>
    </table>
    <div class="row g-2 mb-3">
      <div class="col-md-6"><input id="wordText" class="form-control" placeholder="‡¶∂‡¶¨‡ßç‡¶¶"></div>
      <div class="col-md-4">
        <select id="wordType" class="form-select">
          <option value="‡¶§‡ßé‡¶∏‡¶Æ">‡¶§‡ßé‡¶∏‡¶Æ</option>
          <option value="‡¶§‡¶¶‡ßç‡¶≠‡¶¨">‡¶§‡¶¶‡ßç‡¶≠‡¶¨</option>
          <option value="‡¶Ö‡¶∞‡ßç‡¶ß-‡¶§‡ßé‡¶∏‡¶Æ">‡¶Ö‡¶∞‡ßç‡¶ß-‡¶§‡ßé‡¶∏‡¶Æ</option>
          <option value="‡¶¶‡ßá‡¶∂‡¶ø">‡¶¶‡ßá‡¶∂‡¶ø</option>
          <option value="‡¶¨‡¶ø‡¶¶‡ßá‡¶∂‡¶ø">‡¶¨‡¶ø‡¶¶‡ßá‡¶∂‡¶ø</option>
        </select>
      </div>
      <div class="col-md-2 d-grid"><button class="btn btn-success" onclick="addWord()"> ‡¶Ø‡ßã‡¶ó</button></div>
    </div>
    <button class="btn btn-info mb-3" onclick="toggleJson('words')">üìÑ</button>

    <!-- Origin Words Section -->
    <h3>Origin Words</h3>
    <table class="table table-bordered table-striped" id="originTable">
      <thead class="table-dark">
        <tr><th>#</th><th>‡¶∂‡¶¨‡ßç‡¶¶</th><th>‡¶≠‡¶æ‡¶∑‡¶æ</th><th>Correct</th><th>Wrong</th><th>Weight</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr>
      </thead><tbody></tbody>
    </table>
    <div class="row g-2 mb-3">
      <div class="col-md-6"><input id="originText" class="form-control" placeholder="‡¶∂‡¶¨‡ßç‡¶¶"></div>
      <div class="col-md-4"><input id="originLang" class="form-control" placeholder="‡¶≠‡¶æ‡¶∑‡¶æ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶Ü‡¶∞‡¶¨‡¶ø, ‡¶´‡¶æ‡¶∞‡¶∏‡¶ø, ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø)"></div>
      <div class="col-md-2 d-grid"><button class="btn btn-success" onclick="addOrigin()"> ‡¶Ø‡ßã‡¶ó</button></div>
    </div>
    <button class="btn btn-info mb-3" onclick="toggleJson('origin')">üìÑ</button>

    <!-- JSON Viewer -->
    <div id="jsonBoxWords" class="jsonBox">
      <label class="fw-bold mt-3">Words JSON (copy only):</label>
      <textarea id="jsonViewWords" class="form-control" rows="10" readonly></textarea>
    </div>
    <div id="jsonBoxOrigin" class="jsonBox">
      <label class="fw-bold mt-3">Origin Words JSON (copy only):</label>
      <textarea id="jsonViewOrigin" class="form-control" rows="10" readonly></textarea>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ---------------- ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶°‡ßá‡¶ü‡¶æ -----------------
const defaultData = {
  words: [
    // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá JSON ‡¶¨‡¶∏‡¶æ‡¶§‡ßá ‡¶π‡¶¨‡ßá
  ],
  originWords: [
    // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá JSON ‡¶¨‡¶∏‡¶æ‡¶§‡ßá ‡¶π‡¶¨‡ßá
  ]
};

// localStorage ‡¶è ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶¨‡¶∏‡¶æ‡¶®‡ßã
if(!localStorage.getItem("quizData")){
  localStorage.setItem("quizData", JSON.stringify(defaultData));
}

// ---------------- localStorage ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶° -----------------
let quizData = JSON.parse(localStorage.getItem("quizData"));
let words = quizData.words;
let originWords = quizData.originWords;

const originOptions = ["‡¶ö‡¶ø‡¶®‡¶æ","‡¶¨‡¶æ‡¶∞‡ßç‡¶Æ‡¶ø‡¶ú","‡¶π‡¶ø‡¶®‡ßç‡¶¶‡¶ø","‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø","‡¶Ü‡¶∞‡¶¨‡¶ø","‡¶´‡¶æ‡¶∞‡¶∏‡¶ø","‡¶™‡¶∞‡ßç‡¶§‡ßÅ‡¶ó‡¶ø‡¶ú","‡¶´‡¶∞‡¶æ‡¶∏‡¶ø","‡¶§‡ßÅ‡¶∞‡ßç‡¶ï‡¶ø"];
let allWords = [];
let currentWordIndex = -1;
let answered = false;

// Initialize weight properties
function initWeights() {
  [...quizData.words, ...quizData.originWords].forEach(w=>{
    if(w.correctCount===undefined) w.correctCount=0;
    if(w.wrongCount===undefined) w.wrongCount=0;
    if(w.weight===undefined) w.weight=1;
  });
}

// Shuffle function
function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()* (i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

// Weighted random selection
function getWeightedRandomWord(){
  const pool = [...quizData.words,...quizData.originWords].filter(w=>w.weight>0);
  const totalWeight = pool.reduce((sum,w)=>sum+w.weight,0);
  let r = Math.random()*totalWeight;
  for(let w of pool){
    if(r<w.weight) return w;
    r-=w.weight;
  }
  return pool[0];
}

// --- nextWord ---
function nextWord() {
  answered=false;
  const currentWord = getWeightedRandomWord();
  currentWordIndex = [...quizData.words,...quizData.originWords].indexOf(currentWord);
  document.getElementById("word").innerText=currentWord.text || "";

  const resultEl=document.getElementById("result");
  resultEl.innerText="";
  resultEl.style.color="";

  const btns=document.querySelectorAll(".btn-group-mcq .btn");
  btns.forEach(b=>{
    b.disabled=false;
    delete b.dataset.type;
    b.classList.remove("correct","wrong");
  });

  let options=[];
  let correctIndex=Math.floor(Math.random()*4);

  if(currentWord.language){
    const other = originOptions.filter(l=>l!==currentWord.language);
    options=shuffleArray(other).slice(0,3);
    options.splice(correctIndex,0,currentWord.language);
  } else {
    const types = ["‡¶§‡ßé‡¶∏‡¶Æ","‡¶§‡¶¶‡ßç‡¶≠‡¶¨","‡¶Ö‡¶∞‡ßç‡¶ß-‡¶§‡ßé‡¶∏‡¶Æ","‡¶¶‡ßá‡¶∂‡¶ø"];
    const other = types.filter(t=>t!==currentWord.type);
    options=shuffleArray(other).slice(0,3);
    options.splice(correctIndex,0,currentWord.type);
  }

  btns.forEach((btn,i)=>{
    btn.dataset.type=options[i];
    btn.innerText=String.fromCharCode(65+i)+". "+options[i];
  });
}

// --- checkAnswer ---
function checkAnswer(btnElement){
  const result=document.getElementById("result");
  const currentWord=[...quizData.words,...quizData.originWords][currentWordIndex];
  if(!currentWord){
    result.textContent="‡¶ï‡ßã‡¶®‡ßã ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§";
    return;
  }
  if(answered){
    result.innerText="‚ö†Ô∏è ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ó‡ßç‡¶∞‡¶π‡¶£‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶®‡ßü";
    result.style.color="orange";
    return;
  }

  const selectedType=(btnElement.dataset.type||"").trim();
  const correctAnswer=((currentWord.type&&currentWord.type.trim())||(currentWord.language&&currentWord.language.trim())||"").trim();
  answered=true;

  if(selectedType===correctAnswer){
    result.innerHTML=`‚úÖ <span style="color:green">‡¶∏‡¶†‡¶ø‡¶ï: ${correctAnswer}</span>`;
    btnElement.classList.add("correct");
    currentWord.correctCount++;
  } else {
    result.innerHTML=`‚ùå ‡¶≠‡ßÅ‡¶≤! <span style="color:green">‡¶∏‡¶†‡¶ø‡¶ï: ${correctAnswer}</span>`;
    btnElement.classList.add("wrong");
    currentWord.wrongCount++;
  }

  // Update weight
  currentWord.weight = Math.max(0, 10 + currentWord.wrongCount - currentWord.correctCount);
  if(currentWord.correctCount>=100) currentWord.weight=0;

  document.querySelectorAll(".btn-group-mcq .btn").forEach(b=>b.disabled=true);
  saveData();
}

// ---------- Admin Panel Functions ----------
function renderWords(){
  const tbody=document.querySelector("#wordsTable tbody");
  tbody.innerHTML="";
  quizData.words.forEach((w,i)=>{
    tbody.innerHTML+=`<tr>
      <td>${i+1}</td><td>${w.text}</td><td>${w.type}</td><td>${w.correctCount}</td><td>${w.wrongCount}</td><td>${w.weight}</td>
      <td>
        <button class="btn btn-sm btn-primary" onclick="editWord(${i})">‚úèÔ∏è</button>
        <button class="btn btn-sm btn-danger" onclick="deleteWord(${i})">üóëÔ∏è</button>
      </td>`;
  });
}

function renderOrigin(){
  const tbody=document.querySelector("#originTable tbody");
  tbody.innerHTML="";
  quizData.originWords.forEach((o,i)=>{
    tbody.innerHTML+=`<tr>
      <td>${i+1}</td><td>${o.text}</td><td>${o.language}</td><td>${o.correctCount}</td><td>${o.wrongCount}</td><td>${o.weight}</td>
      <td>
        <button class="btn btn-sm btn-primary" onclick="editOrigin(${i})">‚úèÔ∏è</button>
        <button class="btn btn-sm btn-danger" onclick="deleteOrigin(${i})">üóëÔ∏è</button>
      </td>`;
  });
}

function addWord(){
  const text=document.getElementById("wordText").value.trim();
  const type=document.getElementById("wordType").value;
  if(!text) return alert("‡¶∂‡¶¨‡ßç‡¶¶ ‡¶¶‡¶ø‡¶®!");
  quizData.words.push({text,type,correctCount:0,wrongCount:0,weight:1});
  saveData(); renderWords(); updateJsonView('words');
  document.getElementById("wordText").value="";
}

function editWord(i){
  const newText=prompt("‡¶∂‡¶¨‡ßç‡¶¶ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:",quizData.words[i].text);
  if(newText===null) return;
  const newType=prompt("‡¶ß‡¶∞‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:",quizData.words[i].type);
  if(newType===null) return;
  quizData.words[i]={ text:newText.trim(), type:newType.trim(), correctCount:quizData.words[i].correctCount, wrongCount:quizData.words[i].wrongCount, weight:quizData.words[i].weight };
  saveData(); renderWords(); updateJsonView('words');
}

function deleteWord(i){
  if(confirm("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")){
    quizData.words.splice(i,1);
    saveData(); renderWords(); updateJsonView('words');
  }
}

function addOrigin(){
  const text=document.getElementById("originText").value.trim();
  const language=document.getElementById("originLang").value.trim();
  if(!text || !language) return alert("‡¶∂‡¶¨‡ßç‡¶¶ ‡¶ì ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶¶‡¶ø‡¶®!");
  quizData.originWords.push({text,language,correctCount:0,wrongCount:0,weight:1});
  saveData(); renderOrigin(); updateJsonView('origin');
  document.getElementById("originText").value=""; document.getElementById("originLang").value="";
}

function editOrigin(i){
  const newText=prompt("‡¶∂‡¶¨‡ßç‡¶¶ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:",quizData.originWords[i].text);
  if(newText===null) return;
  const newLang=prompt("‡¶≠‡¶æ‡¶∑‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:",quizData.originWords[i].language);
  if(newLang===null) return;
  quizData.originWords[i]={ text:newText.trim(), language:newLang.trim(), correctCount:quizData.originWords[i].correctCount, wrongCount:quizData.originWords[i].wrongCount, weight:quizData.originWords[i].weight };
  saveData(); renderOrigin(); updateJsonView('origin');
}

function deleteOrigin(i){
  if(confirm("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")){
    quizData.originWords.splice(i,1);
    saveData(); renderOrigin(); updateJsonView('origin');
  }
}

function resetData(){
  if(confirm("‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶°‡¶æ‡¶ü‡¶æ‡ßü ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")){
    quizData=JSON.parse(JSON.stringify(defaultData));
    initWeights(); saveData(); renderWords(); renderOrigin(); updateJsonView('words'); updateJsonView('origin');
  }
}

function saveData(){
  localStorage.setItem("quizData",JSON.stringify(quizData));
  words=quizData.words; originWords=quizData.originWords;
}

function toggleJson(type){
  if(type==='words'){
    const box=document.getElementById("jsonBoxWords");
    box.style.display=box.style.display==='none'?'block':'none';
    updateJsonView('words');
  } else {
    const box=document.getElementById("jsonBoxOrigin");
    box.style.display=box.style.display==='none'?'block':'none';
    updateJsonView('origin');
  }
}

function updateJsonView(type){
  const arr = type==='words'? quizData.words : quizData.originWords;
  const lines = arr.map(o=>JSON.stringify(o));
  if(type==='words'){
    document.getElementById("jsonViewWords").value = lines.join(",\n");
  } else {
    document.getElementById("jsonViewOrigin").value = lines.join(",\n");
  }
}

// ---------- Section Toggle ----------
function showQuiz(){
  document.getElementById("quizSection").style.display="block";
  document.getElementById("adminPanel").style.display="none";
}
function showAdmin(){
  document.getElementById("quizSection").style.display="none";
  document.getElementById("adminPanel").style.display="block";
}

// --- init ---
window.onload = ()=>{
  initWeights();
  renderWords();
  renderOrigin();
  nextWord();
};
</script>
</body>
</html>
